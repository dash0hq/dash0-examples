# Traefik Helm Chart Configuration

# Use hostPort for Kind
ports:
  web:
    hostPort: 80
  websecure:
    hostPort: 443
  traefik:
    hostPort: 8080

# Node selector for ingress-ready node
nodeSelector:
  ingress-ready: "true"

# Tolerations for control-plane
tolerations:
  - key: node-role.kubernetes.io/control-plane
    operator: Equal
    effect: NoSchedule

# Enable dashboard
ingressRoute:
  dashboard:
    enabled: true

# API configuration
api:
  insecure: true

# Experimental features
experimental:
  otlpLogs: true

# Logs configuration
logs:
  general:
    format: json
    level: INFO
  access:
    enabled: true
    format: json

additionalArguments:
  - --experimental.otlpLogs=true
  - --log.otlp=true
  - --log.otlp.grpc=true
  - --log.otlp.grpc.insecure=true
  - --log.otlp.grpc.endpoint=otel-collector-opentelemetry-collector.opentelemetry.svc.cluster.local:4317
  - --accesslog.otlp=true
  - --accesslog.otlp.grpc=true
  - --accesslog.otlp.grpc.insecure=true
  - --accesslog.otlp.grpc.endpoint=otel-collector-opentelemetry-collector.opentelemetry.svc.cluster.local:4317

# Metrics configuration
metrics:
  otlp:
    enabled: true
    addRoutersLabels: true
    addServicesLabels: true
    addEntryPointsLabels: true
    http:
      enabled: true
      endpoint: http://otel-collector-opentelemetry-collector.opentelemetry.svc.cluster.local:4318/v1/metrics
    pushInterval: 10s
  # Disable Prometheus metrics (using OTLP instead)
  prometheus: null

# Tracing configuration
tracing:
  otlp:
    enabled: true
    http:
      enabled: true
      endpoint: http://otel-collector-opentelemetry-collector.opentelemetry.svc.cluster.local:4318/v1/traces

# Environment variables to fix OpenTelemetry resource detection
env:
  - name: USER
    value: "traefik"